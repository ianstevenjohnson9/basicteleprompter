<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teleprompter</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            background-color: #1a1a2e;
            color: #ffffff;
            overflow: hidden;
        }
        .teleprompter-view {
            transition: transform 0.1s ease-out;
        }
        .controls-container {
            transition: opacity 0.3s ease-in-out;
        }
        /* Override Carrd's default body styling for a full-screen app */
        #page-body, body {
            padding: 0;
            margin: 0;
        }
        .carrd-main-wrapper {
            position: absolute;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
        }
    </style>
</head>
<body class="flex flex-col h-screen">

    <!-- Controls Panel -->
    <div id="controls-panel" class="controls-container flex flex-col p-4 space-y-4">
        <h1 class="text-3xl font-bold text-center text-purple-400">Simple Teleprompter</h1>
        <div class="flex-grow flex flex-col space-y-4 md:flex-row md:space-x-4 md:space-y-0">
            <textarea id="script-input" 
                      class="flex-grow p-4 bg-gray-800 rounded-lg shadow-inner focus:outline-none focus:ring-2 focus:ring-purple-500 transition duration-300 h-64 md:h-auto"
                      placeholder="Paste or type your script here..."></textarea>
            
            <div class="flex-shrink-0 flex flex-col space-y-4 bg-gray-900 p-4 rounded-lg shadow-lg w-full md:w-1/3">
                
                <!-- Speed Control -->
                <div>
                    <label for="speed-range" class="block mb-2 text-sm font-medium text-gray-400">Scroll Speed</label>
                    <div class="flex items-center space-x-2">
                        <span class="text-xs text-gray-400">Slow</span>
                        <input type="range" id="speed-range" min="1" max="10" value="5"
                               class="flex-grow h-2 bg-purple-200 rounded-lg appearance-none cursor-pointer">
                        <span class="text-xs text-gray-400">Fast</span>
                    </div>
                </div>

                <!-- Font Size Control -->
                <div>
                    <label for="font-size-range" class="block mb-2 text-sm font-medium text-gray-400">Font Size</label>
                    <div class="flex items-center space-x-2">
                        <span class="text-xs text-gray-400">Small</span>
                        <input type="range" id="font-size-range" min="16" max="64" value="28"
                               class="flex-grow h-2 bg-purple-200 rounded-lg appearance-none cursor-pointer">
                        <span class="text-xs text-gray-400">Large</span>
                    </div>
                </div>

                <!-- Action Buttons -->
                <div class="flex flex-col space-y-2 pt-4 border-t border-gray-700">
                    <button id="start-btn" class="py-3 px-6 rounded-full bg-green-600 hover:bg-green-700 transition-colors duration-300 font-bold text-white shadow-md">Start Prompter</button>
                    <button id="stop-btn" class="py-3 px-6 rounded-full bg-red-600 hover:bg-red-700 transition-colors duration-300 font-bold text-white shadow-md">Pause</button>
                    <button id="reset-btn" class="py-3 px-6 rounded-full bg-gray-600 hover:bg-gray-700 transition-colors duration-300 font-bold text-white shadow-md">Reset</button>
                </div>

            </div>
        </div>
    </div>

    <!-- Teleprompter View (Hidden by default) -->
    <div id="prompter-view" class="teleprompter-view hidden fixed inset-0 bg-gray-900 p-8 overflow-y-auto cursor-pointer" onclick="togglePlayPause()">
        <p id="script-display" class="leading-relaxed text-center" style="transform: translateY(100vh);"></p>
    </div>

    <script>
        const scriptInput = document.getElementById('script-input');
        const scriptDisplay = document.getElementById('script-display');
        const startBtn = document.getElementById('start-btn');
        const stopBtn = document.getElementById('stop-btn');
        const resetBtn = document.getElementById('reset-btn');
        const prompterView = document.getElementById('prompter-view');
        const controlsPanel = document.getElementById('controls-panel');
        const speedRange = document.getElementById('speed-range');
        const fontSizeRange = document.getElementById('font-size-range');
        const body = document.body;

        let isPlaying = false;
        let animationFrameId = null;
        let lastTimestamp = null;
        let scrollPosition = window.innerHeight;

        // Restore script from local storage if it exists
        window.addEventListener('load', () => {
            const savedScript = localStorage.getItem('teleprompterScript');
            if (savedScript) {
                scriptInput.value = savedScript;
            }
        });

        // Save script to local storage on input change
        scriptInput.addEventListener('input', () => {
            localStorage.setItem('teleprompterScript', scriptInput.value);
        });

        // Toggle between controls and prompter view
        function toggleView() {
            prompterView.classList.toggle('hidden');
            prompterView.classList.toggle('flex');
            controlsPanel.classList.toggle('hidden');
        }

        // The main scrolling loop
        function animateScroll(timestamp) {
            if (!lastTimestamp) lastTimestamp = timestamp;
            const deltaTime = timestamp - lastTimestamp;
            lastTimestamp = timestamp;

            // Calculate scroll step based on speed range and time elapsed
            const speed = (11 - speedRange.value) * 0.5; // Invert and scale speed
            const scrollStep = (deltaTime / 1000) * speed * 30; // Adjust multiplier for fine-tuning

            scrollPosition -= scrollStep;
            scriptDisplay.style.transform = `translateY(${scrollPosition}px)`;

            // Check if we've reached the end of the script
            if (scrollPosition <= -(scriptDisplay.offsetHeight)) {
                stopPrompter();
            } else {
                animationFrameId = requestAnimationFrame(animateScroll);
            }
        }

        // Start the prompter
        startBtn.addEventListener('click', () => {
            // Get the script and update the display
            scriptDisplay.textContent = scriptInput.value;
            // Set font size
            scriptDisplay.style.fontSize = `${fontSizeRange.value}px`;
            
            // Toggle to prompter view
            toggleView();

            // Set initial position
            scrollPosition = window.innerHeight;
            scriptDisplay.style.transform = `translateY(${scrollPosition}px)`;

            isPlaying = true;
            lastTimestamp = null; // Reset timestamp for smooth start
            animationFrameId = requestAnimationFrame(animateScroll);
        });

        // Stop the prompter
        function stopPrompter() {
            if (animationFrameId) {
                cancelAnimationFrame(animationFrameId);
                animationFrameId = null;
            }
            isPlaying = false;
        }

        // Pause/Resume button
        stopBtn.addEventListener('click', () => {
            if (isPlaying) {
                stopPrompter();
                stopBtn.textContent = 'Resume';
                stopBtn.classList.remove('bg-red-600');
                stopBtn.classList.add('bg-blue-600');
            } else {
                isPlaying = true;
                lastTimestamp = null; // Reset timestamp for smooth resume
                animationFrameId = requestAnimationFrame(animateScroll);
                stopBtn.textContent = 'Pause';
                stopBtn.classList.remove('bg-blue-600');
                stopBtn.classList.add('bg-red-600');
            }
        });

        // Reset button
        resetBtn.addEventListener('click', () => {
            stopPrompter();
            stopBtn.textContent = 'Pause';
            stopBtn.classList.remove('bg-blue-600');
            stopBtn.classList.add('bg-red-600');
            // Return to controls view and reset position
            if (prompterView.classList.contains('flex')) {
                toggleView();
            }
            scrollPosition = window.innerHeight;
            scriptDisplay.style.transform = `translateY(${scrollPosition}px)`;
        });

        // Click on the prompter screen to toggle play/pause
        function togglePlayPause() {
            if (isPlaying) {
                stopPrompter();
            } else {
                isPlaying = true;
                lastTimestamp = null; // Reset timestamp for smooth resume
                animationFrameId = requestAnimationFrame(animateScroll);
            }
        }
    </script>
</body>
</html>
